<p>You are invited to <%= @lecture.lecture_title %> lecture that occur <%= @lecture.num_times %> per week for <%= float_to_time(@lecture.duration) %> hours per day</p>
<%= form_tag controller: :event, action: :participate, id: @lecture.id do %>
<label>Enter your name: </label><input type="text" name="name"><br>
<p>Please Choose the suitable time for you by clicking the table cells</p>
<table>
  <tr>
    <th>Time/Date</th>
    <th>Sunday</th>
    <th>Monday</th>
    <th>Tuesday</th>
    <th>Wednesday</th>
    <th>Thursday</th>
    <th>Friday</th>
    <th>Saturday</th>
  </tr>
  <%
    # @timetable is a hash with keys of the form [28800, 'Sunday'], [28800, 'Monday'], ...
    # where 28800 is the number of seconds since the beginning of the day and 'Sunday' is the day
    base = @lecture.available_times.first.from if @lecture.available_times.count > 0
    base ||= Time.now
    (28800..52200).step(1800).each do |seconds|
      concat "<tr>".html_safe
      _start = seconds_to_12_hour_time(seconds)
      _end = seconds_to_12_hour_time(seconds + 1800)
      concat "<th>#{_start} - #{_end}</th>".html_safe
      ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'].each do |day|
        if(@timetable[[seconds, day]])
          time = AvailableTime.build_on_day(day: day, from: seconds, to: seconds + 1800, base: base)
          concat "<td class='available' data-time='#{time.from.to_i}'></td>".html_safe
        else
          concat "<td></td>".html_safe
        end
      end
      concat "</tr>".html_safe
    end
  %>
</table>

<p>Legend</p>
<ul class="legend">
  <li style="color: cyan"><span>Available</span></li>
  <li style="color: gray"><span>Not Available</span></li>
  <li style="color: green"><span>Suitable</span></li>
  <li style="color: red"><span>Not Suitable</span></li>
</ul>

<div id="selected_times"></div>
<input type="submit" name="submit" value="Submit">
<% end %>

<script>
  participate_init();
</script>
